function _bindShadowClick(){_createShadow().onclick=function(n){if(n.target===this){var e=this,t=e.querySelector(".modal-content"),o=e.parentElement;_dismissModal(o,e,t)}}}function _addOpenAnimationToModal(){var n,e=document.querySelectorAll(".modal-wrap");for(n=e.length-1;n>=0;n--)!function(n){e[n].classList.add("openAnimation")}(n)}function _addCloseAnimationBeforeDismiss(){_dismissModal=function(n){return function(e,t,o){var i=arguments,a=t.onclick||null,d=function(o){n.apply(this,i),document.body.removeEventListener("animationend",d),e.classList.remove("closeAnimation"),t.onclick=a};t.onclick=null,e.classList.add("closeAnimation"),document.body.addEventListener("animationend",d)}}(_dismissModal)}function _openModal(n,e,t){n.removeChild(t),e.appendChild(t),n.appendChild(e),n.classList.add("modal-show")}function _dismissModal(n,e,t){e.removeChild(t),n.removeChild(e),n.appendChild(t),n.classList.remove("modal-show")}function _addCrossToHeader(){var n,e=document.createElement("link"),t=document.querySelectorAll(".modal-header");for(e.rel="stylesheet",e.href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css",document.head.appendChild(e),n=t.length-1;n>=0;n--)!function(n){var e=document.createElement("i");e.classList.add("fa","fa-times","modal-header-cross"),t[n].appendChild(e)}(n);return document.querySelectorAll(".modal-header-cross")}function _bindOpenHandler(n){for(var e=n.length-1;e>=0;e--)n[e].onclick=function(){var n=this.getAttribute("data-target"),e=document.querySelector("#"+n),t=_createShadow(),o=e.querySelector(".modal-content");_openModal(e,t,o),t.offsetHeight<o.offsetHeight-40?t.classList.add("block"):t.classList.remove("block"),this.blur(),o.focus()}}function _getModalFromInside(n){return n&&n.classList.contains("modal-wrap")?n:_getModalFromInside(n.parentElement)}function _bindCancelHandler(n){for(var e=n.length-1;e>=0;e--)n[e].onclick=function(){var n=_getModalFromInside(this),e=n.querySelector(".modal-shadow"),t=e.querySelector(".modal-content");_dismissModal(n,e,t)}}function _bindEscHandler(){var n,e=document.querySelectorAll(".modal-content");for(n=e.length-1;n>=0;n--)e[n].setAttribute("tabIndex","1"),e[n].onkeydown=function(n){var e=this,t=this.parentElement,o=_getModalFromInside(this),i=n.charCode||n.keyCode;27===i&&_dismissModal(o,t,e)}}function _before(n,e){return function(){return e.apply(this,arguments),n.apply(this,arguments)}}function _after(n,e){return function(){var t=n.apply(this,arguments);return e.apply(this,arguments),t}}var Modal=function(n){this.buttons=document.querySelectorAll("[data-toggle=modal]"),this.cancels=document.querySelectorAll("[data-dismiss=modal]"),this.conf=n};Modal.prototype.init=function(){var n=0;return function(){var e=this,t=function(){var t=e.buttons,o=e.cancels,i=e.conf;if(console.log(e.conf),i&&i.close){var a=_addCrossToHeader();_bindCancelHandler(a)}i&&i.animation&&(_addOpenAnimationToModal(),_addCloseAnimationBeforeDismiss()),i&&i.shadowClose&&_bindShadowClick(),_bindEscHandler(),_bindCancelHandler(o),_bindOpenHandler(t),n++},o=function(){console.log("init函数只能执行一次，不然会出错")};return 0===n?t():o()}}();var _createShadow=function(){var n=null,e=function(){return n=document.createElement("div"),n.classList.add("modal-shadow"),t(),n},t=function(){var e;window.onresize=function(){clearTimeout(e),e=setTimeout(function(){n.style.height=window.innerHeight+"px",n.style.width=window.innerWidth+"px"},20)}};return function(){return n=n||e(),n.style.height=window.innerHeight+"px",n.style.width=window.innerWidth+"px",n}}();